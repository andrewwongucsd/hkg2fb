<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE-edge">
  <title>HKG2FB</title>
</head>
<body>
  <script>
  function deleteAllCookies() {
    var cookies = document.cookie.split(";");

    for (var i = 0; i < cookies.length; i++) {
    	var cookie = cookies[i];
    	var eqPos = cookie.indexOf("=");
    	var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
    	document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
}
  function publishPhotoToPageAlbum(){
    console.log("publishPhotoToPageAlbum Function");
    var pageInfo = {};
    var payload = {};

    var albumid = '161087720974265';
    payload.url = 'https://i1.i-mg.co/ilGJ3.png';
    payload.message = '有時會見到佢地,得閒可捉番隻番屋企';
    payload.no_story = true;

    // First to get
    FB.api('/me/accounts',function(response){
      console.log('/me/accounts');
      console.log(response);
      pageInfo = response.data[1];
      payload.access_token = pageInfo.access_token;
      console.log(payload);
    });
    FB.api(
      '/'+albumid+'/photos',
      'POST',
      payload,
      function(response){
        console.log(response);
        if(response.error){
          document.getElementById('status').innerHTML = 'fail '+payload.url;

        }else{
          document.getElementById('status').innerHTML = 'successful '+payload.url;

        }

      }
    );
    deleteAllCookies();
  }
  window.fbAsyncInit = function(){
    FB.init({
      appId: '1827005040861675',cookie: true,xfbml: true,version: 'v2.7'
    });

    FB.getLoginStatus(function(response){
      statusChangeCallback(response,publishPhotoToPageAlbum);
    })
  };

  (function(d, s, id) {
    console.log(d);
    console.log(s);
    console.log(id);
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  function click(){
    FB.getLoginStatus(function(response){
      statusChangeCallback(response, publishPhotoToPageAlbum);
    })
  }
  function statusChangeCallback(response, loggedInToActFunction){
    // get Page Access Token to publish photos to photo album
    console.log(response);
    if(response.status === 'connected'){
      // do things here!
      loggedInToActFunction();
    }else if(response.status === 'not_authorized'){
      document.getElementById('status').innerHTML = 'Please log in to the App.';
    }else{
      document.getElementById('status').innerHTML = 'Please log in to Facebook';
    }
  };

  </script>
  <form id="usrform">
    album id: <input id="albumid" type="text" name="usrname">
  </form><br>
  <textarea id="hkgcode" rows="4" cols="50" name="comment" form="usrform"></textarea>
  <button onclick="parsenpost()"> Parse and Post! </button>
  <div id="status"></div>
  <fb:login-button scope="public_profile,email" onlogin="checkLoginState();"></fb:login-button>
  <!-- <button onclick="login()">Login</button> -->
  <div
    class="fb-like"
    data-share="true"
    data-width="450"
    data-show-faces="true">
  </div>
</body>
</html>
