<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE-edge">
  <title>HKG2FB</title>
</head>
<body>
  <script>
  function deleteAllCookies() {
    var cookies = document.cookie.split(";");

    for (var i = 0; i < cookies.length; i++) {
    	var cookie = cookies[i];
    	var eqPos = cookie.indexOf("=");
    	var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
    	document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
    }
}
  function publishPhotoToPageAlbum(){
    console.log("publishPhotoToPageAlbum Function");
    var pageInfo = {};
    var payload = {};
    var albumid = '161087720974265';
    var pageid = '113793925703645';
    payload.url = 'https://i1.i-mg.co/ilGJ3.png';
    payload.message = '有時會見到佢地,得閒可捉番隻番屋企';
    payload.no_story = true;

    FB.login(function(response){
      console.log(response);
      if(response.authResponse){
        // First to get
        payload.access_token = response.authResponse.accessToken;
        FB.api('/me/accounts',function(response){
          console.log('/me/accounts');
          console.log(response);
          for(var i = 0; i < response.data.length; i++){
            if(response.data[i].id === pageid){
              pageInfo = response.data[i];
              break;
            }
          }
          // payload.access_token = pageInfo.access_token;
          // payload.access_token = "EAAZA9psJ2oesBAOsPqRsbUftz2ft0Wt158u2MeOZAh9TNeq1uHQgZCIuVbtMqlgU3PB8UBTP6tcd1E1KQwEXO3DzfvakzwxmlzZAVUmtifRZBxHUneeMMU7dkql0Ffso8waJY6AO4QqRZAn6xnnPMo6ke7kqye0pibZCDNZAMwUQmAZDZD";

          console.log(payload);
        });
        FB.api(
          '/'+albumid+'/photos',
          'POST',
          payload,
          function(response){
            console.log(response);
            if(response && !response.error){
              document.getElementById('status').innerHTML = 'successful '+payload.url;
            }else{
              document.getElementById('status').innerHTML = 'fail '+payload.url;
            }
          }
        );
      }else{
        console.log('User cancelled Login or did not fully authorize.');
      }
    },{
      scope: 'email, manage_pages, publish_pages, publish_actions, public_profile',
      return_scopes: true
    });

    // deleteAllCookies();
  }
  window.fbAsyncInit = function(){
    FB.init({
      appId: '1827005040861675',cookie: true,xfbml: true,version: 'v2.7'
    });

    FB.getLoginStatus(function(response){
      statusChangeCallback(response,publishPhotoToPageAlbum);
    })
  };

  (function(d, s, id) {
    console.log(d);
    console.log(s);
    console.log(id);
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  function click(){
    FB.getLoginStatus(function(response){
      statusChangeCallback(response, publishPhotoToPageAlbum);
    })
  }
  function statusChangeCallback(response, loggedInToActFunction){
    // get Page Access Token to publish photos to photo album
    console.log(response);
    if(response.status === 'connected'){
      // do things here!
      loggedInToActFunction();
    }else if(response.status === 'not_authorized'){
      document.getElementById('status').innerHTML = 'Please log in to the App.';
    }else{
      document.getElementById('status').innerHTML = 'Please log in to Facebook';
    }
  };

  </script>
  <form id="usrform">
    album id: <input id="albumid" type="text" name="usrname">
  </form><br>
  <textarea id="hkgcode" rows="4" cols="50" name="comment" form="usrform"></textarea>
  <button onclick="parsenpost()"> Parse and Post! </button>
  <div id="status"></div>
  <fb:login-button scope="public_profile,email" onlogin="checkLoginState();"></fb:login-button>
  <!-- <button onclick="login()">Login</button> -->
  <div
    class="fb-like"
    data-share="true"
    data-width="450"
    data-show-faces="true">
  </div>
</body>
</html>
